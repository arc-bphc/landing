---
title: Level 5
category: 'resource'
level: 5
tags: ['levelup', 'electronics']
---
# Programming and Electronics

# Prerequisites

- Data Types
- Control Blocks - if/else
- Sequential Iteration - Loops

# A Brief Outline

- Arrays and Pointers
- Scopes
- Functions
- Sensors: The Ultrasonic Sensor
- PIR
- 7805 IC
- Motor Drivers & H-Bridges-L293D
- Servo motor and Servo library
- Ultrasonic Sensor : HC SR04

## Arrays

A collection of objects with the same datatype.

Remember Strings? Try implementing your own strings with this knowledge.

Sample Code:


```c++
int iArr[6];

float fArr[] = {1.0f, 2.0f, 3.3f, 4.2f}

// Does this work?
long lArr[6] = {1, 2, 3};

//Does this work? What changes if not?
char str[ ] = "abcdef";
```

Indexing of an Array

<Image 
    src="static/images/levelup/level-5/arrayindex.PNG" 
    alt="Array Index" 
    width='400px' 
    height='auto'
/>

## Accessing Elements

Note the following points about arrays while accessing elements:

- 0 indexed: i.e. first element is at position (or index) 0.
- if array of length 'n' last element at index 'n-1'.
    (What is there at index n?)

Sample Code:

```c++
int iArr[6] = {0, 1, 1, 2, 3, 5};

// iArr[3] == 2

// Invalid Syntax:
// iArr[6], iArr[7], iArr[-1]

//Set the 5th element to 420

iArr[4] = 420;
```

**Exercise:** Try printing all the elements of an array on the Serial Monitor.

## User Defined Functions

- Functions are subroutines, or small fragments of code.
- They can take parameters and can return output.

```c++
<type> name([ <type> [name], ...] ) {
    // Some Code
     return <data:type>
}

int walk(int speed, int x) {
    x += speed;
    return x;
}
```

Syntax is expressed through convention.

1.  <> : have relevant placeholders, eg: `<type>`

2.  []: optional items; May or may not exist for proper functioning.

## Why Functions?

- Functions typically perform a singular task and return a result.
- Typical Use case is when you need to repeat the same code multiple times with slight variation.
- Provide a level of abstraction to the code and reduces repetition.

```c++
int myCoordinate = 0, mySpeed = 1;

int walk( int speed, int x) {
    x += speed;
    return x;
}

// void because it does not return anything
void setup( ) { }

void loop( ) {
    myCoordinate = walk(mySpeed, myCoordinate);
    delay(100);
}
```

1.  After approximately how much time, if at all does the value of myCoordinate become 0 again?
2.  Check out passing variables by reference and improve this code. Specifically Line 12.

## PIR

PASSIVE INFRARED SENSOR:

- PIR sensors are made of pyroelectric material, which is used to detect the levels of infrared radiation in the surroundings. The way this sensor works is actually quite interesting and is nicely explained [here](https://learn.adafruit.com/pir-passive-infrared-proximity-motion-sensor/how-pirs-work).
- Follow the link to go to the [datasheet](https://www.epitran.it/ebayDrive/datasheet/44.pdf).

<Image 
    src="static/images/levelup/level-6/70e32a17599ed5becda28990c1442cf7.png" 
    alt="PIR" 
    width='900px' 
    height='auto'>


VIDEO TUTORIALS:
Follow these videos for some tutorials on circuit connections and code explanations -

- [VIDEO (1)](https://www.youtube.com/watch?v=6Fdrr_1guok)
- [VIDEO (2)](https://www.youtube.com/watch?v=WLrOQKqty1I)

A small exercise:
Simulate this in TinkerCAD after watching this [video](https://www.youtube.com/watch?v=EsD5gHVLmKw).

## Voltage Regulator 7805 IC

- Voltage regulators are used to ensure steady and constant output from voltage sources.
- The integrated circuits used for voltage regulation are called Voltage regulator ICs.
- The 7805 IC is one of 78xx series. More information about 7805 and its components can be found [here](https://www.electronicshub.org/understanding-7805-ic-voltage-regulator/).

<Image 
    src="static/images/levelup/level-6/7805IC.png" 
    alt="7805IC" 
    width='auto' 
    height='400px'
/>

| Pin No. | Pin | Function | Description |
| --- | --- | --- | --- |
| 1   | INPUT | Input Voltage (7V-35V) | In this pin of the IC positive unregulated voltage is given in regulation |
| 2   | GROUND | Ground(0V) | In this pin where the ground is given. This pin is neutral for equally the input and output |
| 3   | OUTPUT | regulated output; 5V(4.8V-5.2V) | The output of the regulated 5V is taken out at this pin of the IC regulator |

A detailed video explanation on the 7805 IC can be found [here](https://www.youtube.com/watch?v=LEv26VH0S1E).

<Image 
    src="static/images/levelup/level-6/favicon-32x32.png" 
    alt="Regulator Circuit Diagram" 
    width='500px' 
    height='auto'
/>

## Servo Motor

- Servos are widely used in rotating joints and are found in variable sizes.
- Servo motor is an electrical device that can push or rotate an object with greater precision.
- A Servo consists of a motor (AC or DC), a potentiometer, gear assembly, and a controlling circuit.
- The position of the servo motor is decided by the electrical pulse given to the signal wire.

<Image 
    src="static/images/levelup/level-6/Servo_lvl6.png" 
    alt="Servo Motor" 
    width='500px' 
    height='auto'
/>


Follow the link for simulating the [TinkerCAD files](https://www.tinkercad.com/things/lPbqaB1MX5D).

Tutorial:

1.  The following [tutorial](https://www.youtube.com/watch?v=LXURLvga8bQ) explains about working of the servo motor and how to program it.
2.  Here are Paul McWhorter’s tutorials. [Understanding Servos](https://www.youtube.com/watch?v=aFHu65LiFok&feature=youtu.be) and [Using Servos](https://www.youtube.com/watch?v=4cdFHZ_Z-_Q&feature=youtu.be).
3.  Follow the [tutorial](https://makezine.com/2014/04/23/arduinos-servo-library-angles-microseconds-and-optional-command-parameters/) for the explanation of the servo library.

Link for the [datasheet](http://www.ee.ic.ac.uk/pcheung/teaching/DE1_EE/stores/sg90_datasheet.pdf) for SG90.


## DC Motor and L293D

- The Motors also come in different sizes and types, the most common ones are the normal DC motor and the Brushless DC motor (BLDC).
- The DC Motor as we all have studied from our school days runs by placing a current-carrying conductor in a magnetic field.
- Since the magnets are already present, we only need to provide the DC current.
- However, the speed and direction of rotation depend on the voltage provided. For this, we use a motor driver such as an L293D
- It’s a 16-pin motor driver IC (see diagram) which can drive to dc motors simultaneously in any direction (clockwise or counter-clockwise).

<Image 
    src="static/images/levelup/level-6/L293D_lvl6.png"
    alt="L293D Diagram" 
    width='400px' 
    height='auto'
/>


### More about L293D

Input pins: The ones to which we give signals
Output pins: The ones connected to the motors.

- We give power to the motors via VCC2 (the actual range is 4.5-36V, but for general motors, 9-12V is good) and power up the IC (5V) via VCC1.
- The enable pins are there to “enable” the output pins. If enable pins are set to logic HIGH then the output pins match up to the input pins.
- If the enable pins are set to logic LOW then regardless of logic states of input pins, the output pins are always set to zero.
- There is a notch on the top of the IC, to guide us with proper connections.
- The IC uses an “H-Bridge” which helps control the direction of rotation of motors.

FOR MORE INFORMATION ON L293D:

- [Here’s the datasheet for the L293d IC.](https://components101.com/sites/default/files/component_datasheet/L293D%20Datasheet.pdf)
- [Connecting dc motors with the IC](https://www.youtube.com/watch?v=fPLEncYrl4Q&feature=youtu.be)
- [More on H-bridge](https://maker.pro/custom/projects/all-you-need-to-know-about-l293d)

<Image 
    src="static/images/levelup/level-6/H-bridge_lvl6.png" 
    alt="H-Bridge" 
    width='350px' 
    height='auto'
/>


## A New Sensor has Appeared!

**Ultrasonic Sensor: HC SR04**

<Image 
    src="static/images/levelup/level-5/hcsr04.png" 
    alt="hcsr04" 
    width='500px' 
    height='auto'
/>

Working:

1.  Emit a pulse (8 pulses) (Why the number 8?)
2.  Pulse Reflected by Object.
3.  Measure the time delay in detection of the reflected pulse from the emission of the initial pulse.

This time delta is proportional to distance of object.

## HC SR04

For a more comprehensive Review and the use of the sensor reference the following resources:

1.  Datasheet and other reading:

- [https://www.electroschematics.com/hc-sr04-datasheet/](https://www.electroschematics.com/hc-sr04-datasheet/)
- [https://components101.com/ultrasonic-sensor-working-pinout-datasheet](https://components101.com/ultrasonic-sensor-working-pinout-datasheet)

2.  Arduino Tutorials by Paul McWhorter:

- [https://www.youtube.com/watch?v=M-UKXCUI0rE](https://www.youtube.com/watch?v=M-UKXCUI0rE)
- [https://www.youtube.com/watch?v=BTMMNsL0_b0](https://www.youtube.com/watch?v=BTMMNsL0_b0)
- [https://www.youtube.com/watch?v=2hwrDSVHQ-E](https://www.youtube.com/watch?v=2hwrDSVHQ-E)

## Assignments

### Assignment 1

Calculate the velocity of an object moving with constant velocity using the HC SR04 Sensor. Assume that the velocity vector of the object points directly towards or away from the HC SR04 transmitter/receiver. (Ignore Doppler Effect)

### Assignment 2

Use this velocity calculated in previous question to calculate the distance of the object after a given time interval. Measure the distance using the HC SR 04 sensor and calculate the error. (Ignore Doppler Effect)

<!-- ### Assignment 3

How would you measure the speed of sound in water using the HC SR04 Sensor and the Arduino UNO? What other materials are required? Try to think solutions as creative as possible. -->

### Assignment 3

You have to simulate a mini-segway (2 wheels only) that avoids obstacles. It takes a 90 degrees(approx) turn on every obstacle detected. For detecting an object you should use 2 PIR Sensors, one for detecting an obstacle on the left side and one for detecting an obstacle on the right side.
The path of the segway should be as follows -

1.  It goes straight until no object is detected on either side.
2.  It takes a 90 degree left turn if the object is detected on the
    right side and then goes straight.
3.  It takes a 90 degree right turn if the object is detected on the
    left side and then goes straight.

An example path (Approximate path) -

<Image 
    src="static/images/levelup/level-6/Ass1_lvl6.png" 
    alt="Assignment 1" 
    width='600px' 
    height='auto'
/>

Specifications :
Radius of wheel = 30 cm
Distance between two wheels = 1 m
At All points rpm of both wheels should be approx 5000 rpm.
Bonus points for those who reduce their rpm to approx 2000 rpm while turning.

Assumptions -

1.  You can assume that the motors can reach 0 rpm in a negligible
    amount of time.

2.  There is sufficient friction so that no slipping takes place.

The time taken by the segway to rotate 90 degrees can be calculated as follows -
<Image 
    src="static/images/levelup/level-6/1_lvl6.png" 
    alt="Segway1" 
    width='500px' 
    height='auto'
/>
<br>

Your setup on TinkerCAD should look something like this -
<Image 
    src="static/images/levelup/level-6/3_lvl6.png" 
    alt="Setup" 
    width='700px' 
    height='auto'
/>


**NOTE - WHEELS ON THE OPPOSITE SIDES**
